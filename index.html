<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>
	<p>Warning: Complex combinations of Repeat and Reset instructions are not properly handled currently. The game is authoritative, this tool may report failures that don't exist (and pass some that shouldn't)</p>
	<label for="solution">Choose TransmutationCX solution:</label>

	<input type="file"
		   id="solution-selector" name="solution"
		   accept=".solution">
   <pre id="square"></pre>
   <pre id="text_out"></pre>
    <!-- Include the JS generated by `wasm-pack build` -->
    <script src='omclone_cxchecker.js'></script>

    <script>
		// Like with the `--target web` output the exports are immediately
		// available but they won't work until we initialize the module. Unlike
		// `--target web`, however, the globals are all stored on a
		// `wasm_bindgen` global. The global itself is the initialization
		// function and then the properties of the global are all the exported
		// functions.
		//
		// Note that the name `wasm_bindgen` can be configured with the
		// `--no-modules-global` CLI flag
		const square_loc = document.getElementById("square");
		const text_loc = document.getElementById("text_out");
		var square_count = 0;
		function add_square(white){
			square_count += 1;
			if (white){
				square_loc.textContent += "O";
			} else {
				square_loc.textContent += "X";
			}
			if (square_count == 8){
				square_loc.textContent += "\n";
				square_count = 0;
			}
		}
		function add_text(str){
			text_loc.textContent += str+"\n";
		}
		
		const { evaluate_solution } = wasm_bindgen;

		async function run() {
			await wasm_bindgen('omclone_cxchecker_bg.wasm');
		}

		const input = document.getElementById('solution-selector');
		//https://dilshankelsen.com/convert-file-to-byte-array/
		async function getAsByteArray(file) {
		  return new Uint8Array(await readFile(file))
		}
		function readFile(file) {
		  return new Promise((resolve, reject) => {
			// Create file reader
			let reader = new FileReader()

			// Register event listeners
			reader.addEventListener("loadend", e => resolve(e.target.result))
			reader.addEventListener("error", reject)

			// Read file
			reader.readAsArrayBuffer(file)
		  })
		}
		
		async function cxCheck(){
			const filename = input.files[0];
			const filedata = await getAsByteArray(filename);
			text_loc.textContent = "";
			square_loc.textContent = "";
			evaluate_solution(filedata);
		}
		input.addEventListener('change', cxCheck);
		
      run();
    </script>


    </script>
  </body>
</html>

